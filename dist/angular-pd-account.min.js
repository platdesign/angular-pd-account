!function(e,n){var t="pd.account";"function"==typeof define&&define.amd?define([t],n):n()}(this,function(){"use strict";var e=angular.module("pd.account",["ngCookies"]);return function(){var e=angular.module("pd.account");e.provider("AccountConfig",[function(){var e=this,n={cookiename:"account",signInRoute:"/signin",afterSignInRoute:"/",afterSignOutRoute:"/",afterSignUpRoute:"/",afterDestroyRoute:"/",onlineRequiredOtherwiseRoute:"/",offlineRequiredOtherwiseRoute:"/",backendUrl:"/account"};this.get=function(e){return n[e]},this.set=function(e,t){n[e]=t},this.setFromObj=function(e){angular.extend(n,e)},this.$get=[function(){return e}]}])}(),function(){var e=angular.module("pd.account");e.provider("Account",["$injector","AccountConfigProvider",function(e,n){this.config=function(e){n.setFromObj(e)},this.onlineRequired=function(e){return e=e||n.get("onlineRequiredOtherwiseRoute"),["$location","$q","Account","$timeout",function(n,t,o,i){var r=t.defer();return o.isOnline()?r.resolve():(r.reject(),i(function(){n.path(e)})),r.promise}]},this.offlineRequired=function(e){return e=e||n.get("offlineRequiredOtherwiseRoute"),["$location","$q","Account","$timeout",function(n,t,o,i){var r=t.defer();return o.isOnline()?(r.reject(),i(function(){n.path(e)})):r.resolve(),r.promise}]};var t=this.Service=function(){this.username=void 0,this.config=n},o=["$http","$q","$cookies","$timeout","$location",function(e,o,i,r,c){var u=function(){var e=o.defer(),n=e.promise;return n.error=function(e){return n.then(null,e),n},n.success=function(e){return n.then(e),n},e};t.prototype.isOnline=t.prototype.isOnline||function(){return i[this.config.get("cookiename")]},t.prototype.signIn=t.prototype.signIn||function(e,n){var t=this,o=new u,r=o.promise;return e&&n?t._signinRequest({email:e,secret:n},function(e){o.resolve(e)},function(){o.reject({message:"Something went wrong"})}):o.reject({message:"Missing input"}),r.success(function(e){e=e||{},i[t.config.get("cookiename")]=!0,t.username=e.username,t.email=e.email,c.path(t.config.get("afterSignInRoute"))}),r},t.prototype._signinRequest=t.prototype._signinRequest||function(n,t,o){e.post(this.config.get("backendUrl")+"/signin",n).success(t).error(o)},t.prototype.signOut=t.prototype.signOut||function(){var e=this;this._signoutRequest(function(){i[e.config.get("cookiename")]=!1,e._reset(),c.path(e.config.get("afterSignOutRoute"))},function(){})},t.prototype._signoutRequest=t.prototype._signupRequest||function(e){e()},t.prototype.signUp=t.prototype.signUp||function(e,n,t){var o=this,r=new u,s=r.promise;return n&&t?o._signupRequest({email:n,secret:t,username:e},function(e){r.resolve(e)},function(){r.reject({message:"Something went wrong"})}):r.reject({message:"Missing input"}),s.success(function(e){e=e||{},i[o.config.get("cookiename")]=!0,o.username=e.username,o.email=e.email,c.path(o.config.get("afterSignUpRoute"))}),s},t.prototype._signupRequest=t.prototype._signupRequest||function(n,t,o){e.post(this.config.get("backendUrl")+"/signup",n).success(t).error(o)},t.prototype.destroy=t.prototype.destroy||function(){this._destroyRequest({},function(){},function(){})},t.prototype._destroyRequest=t.prototype._destroyRequest||function(e,n){n()},t.prototype._reset=t.prototype._reset||function(){this.username=void 0,delete i[this.config.get("cookiename")]},t.prototype.load=t.prototype._load||function(){var e=this;this.isOnline()&&this._loadRequest(function(){e.username="plati"},function(){e._reset(),console.error("pdAccount: cant load account data")})},t.prototype._loadRequest=t.prototype._loadRequest||function(t,o){e.get(n.get("backendUrl")).success(t).error(o)};var s=new t;return s.load(),s}];this.$get=o}])}(),function(){var e=angular.module("pd.account");e.directive("pdAccountButton",[function(){return{restrict:"E",template:'<button ng-class="class" ng-click="process()">{{label()}}</button></div>',replace:!0,scope:{},link:function(){},controller:["$scope","Account","$location",function(e,n,t){e.class={"btn-singin":n.isOnline},e.label=function(){return n.isOnline()?"Sign out":"Sign In"},e.process=function(){n.isOnline()?n.signOut():t.path(n.config.get("signInRoute"))}}]}}])}(),function(){var e=angular.module("pd.account");e.directive("pdAccountDoorman",[function(){return{restrict:"E",template:'<div ng-switch on="a"><div ng-switch-default><pd-account-sign-in-form></pd-account-sign-in-form>No account? <a href="" ng-click="s(1)">Sign up</a>.</div><div ng-switch-when="1"><pd-account-sign-up-form></pd-account-sign-up-form>Already an account? <a href="" ng-click="s()">Sign in</a>.</div></div>',replace:!0,scope:{},link:function(){},controller:["$scope","Account",function(e){e.s=function(n){e.a=n}}]}}])}(),function(){var e=angular.module("pd.account");e.directive("pdAccountSignInForm",[function(){return{restrict:"E",template:'<form name="form" ng-submit="process()" class="pd-account-sign-in-form"><input type="email" placeholder="eMail" ng-model="email" required/><input type="password" placeholder="Password" ng-model="secret" required/><button type="submit" ng-disabled="form.$invalid">Sign In</button><div ng-if="error" class="hint-error">{{error}}</div></form>',replace:!0,scope:{},link:function(){},controller:["$scope","Account",function(e,n){e.process=function(){n.signIn(e.email,e.secret).success(function(){console.log("success")}).error(function(n){e.error=n.message}),e.secret=void 0}}]}}])}(),function(){var e=angular.module("pd.account");e.directive("pdAccountSignUpForm",[function(){return{restrict:"E",template:'<form name="form" ng-submit="process()" class="pd-account-sign-up-form"><input type="text" placeholder="Username" ng-model="username" required/><input type="email" placeholder="eMail" ng-model="email" required/><input type="password" placeholder="Password" ng-model="secret" required/><button type="submit" ng-disabled="form.$invalid">Sign Up</button></form>',replace:!0,scope:{},link:function(){},controller:["$scope","Account",function(e,n){e.process=function(){n.signUp(e.email,e.secret,{username:e.username})}}]}}])}(),e});